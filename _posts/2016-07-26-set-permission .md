---
layout: post
title: CI框架添加简单的权限分配功能
category: php
tags: ci
keywords: CI,权限,
description: 在CI的框架上给后台添加上简单的权限分配功能
---  

## 需求

  后台管理总是伴随着各种限制条件功能，以前接触dede时简单的接触过他们的分配权限方法，只是那时能力有限，仅仅停留在使用上面，算不上真正的修改。  
  业务需求，要在CI框架基础上添加权限分配功能，后台有总管理员，然后不同的管理员有不同的访问权限。  

## 想法  

  现在使用的CI框架是在原同事修改的基础上再做修改，现在是管理员和后台按钮已经成型，需要做的是在给管理员添加上权限就可以了。  
  由于业务相对简单，仅仅只有一层权限关系，所以就没有涉及到父权限和子权限的功能。
  
>  开始时构想的一种最简单的方法就是在管理员表添加个权限字段，存储分配的权限。  
>  这个仅仅是把对应的权限关联到管理员表中，简单易行。缺点是修改权限时需要逐个管理员修改   
>  于是加入分组的功能（其他大部分cms均是这种方法）。先添加一个权限组，然后管理员归属于这个组即可。优点是如果更改大批量权限时就比较方便，缺点是~得多码点代码，多想想他们关系，不过这个明显比上一个要有利。  
  
## 步骤  
使用的框架是 CodeIgniter 2.x，是在一个很厉害的同事二次开发的基础上再做添加。  
现在已经有管理员(数据表，操作文件），操作按钮(配置文件)。    

>  1. 操作按钮里增加权限id信息。  
>  配置文件放置在application/config/admin_menu.php文件  

  ` 
  前台模版引用  $controller->config->load('admin_menu');    
  获取按钮变量  $menu = $controller->config->item('menu');   
  `   
  
>  获取权限，匹配是否显示该按钮。  
>  2. 增加权限组表。id,name,limit。   
>  3. 增加管理员归属权限的字段type。   

通过2和3，增加权限组和管理员关联功能。  

> 4. 添加查询管理员当前权限的辅助文件，为了提升访问速度，查询出来的权限可以设置到缓存中。  
> 5. 后台按钮文件中获取到操作按钮，然后和用户权限匹对，决定是否显示。  
> 6. 控制器中添加权限检查功能。  决定是否能执行该控制器。   

## 问题  
1. 安全问题，这个对于一部分的权限访问有点不安全。  
2. 管理。  
3. 权限可以添加到数据库表中。  

总觉得有些要完善的地方，下步慢慢的完善吧。

## 人丑就该多读书  
<center><embed src="http://player.youku.com/player.php/sid/XNTE2NTkwMDU2/v.swf" allowFullScreen="true" quality="high" width="480" height="400" align="middle" allowScriptAccess="always" type="application/x-shockwave-flash"></center>
